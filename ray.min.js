(function(root,mod){if(typeof exports=="object"&&typeof module=="object")return mod(exports);if(typeof define=="function"&&define.amd)return define(["exports"],mod);mod(root.acorn||(root.acorn={}))})(this,function(exports){"use strict";exports.version="0.4.1";var options,input,inputLen,sourceFile;exports.parse=function(inpt,opts){input=String(inpt);inputLen=input.length;setOptions(opts);initTokenState();return parseTopLevel(options.program)};var defaultOptions=exports.defaultOptions={ecmaVersion:5,strictSemicolons:false,allowTrailingCommas:true,forbidReserved:false,locations:false,onComment:null,ranges:false,program:null,sourceFile:null,directSourceFile:null};function setOptions(opts){options=opts||{};for(var opt in defaultOptions)if(!Object.prototype.hasOwnProperty.call(options,opt))options[opt]=defaultOptions[opt];sourceFile=options.sourceFile||null}var getLineInfo=exports.getLineInfo=function(input,offset){for(var line=1,cur=0;;){lineBreak.lastIndex=cur;var match=lineBreak.exec(input);if(match&&match.index<offset){++line;cur=match.index+match[0].length}else break}return{line:line,column:offset-cur}};exports.tokenize=function(inpt,opts){input=String(inpt);inputLen=input.length;setOptions(opts);initTokenState();var t={};function getToken(forceRegexp){readToken(forceRegexp);t.start=tokStart;t.end=tokEnd;t.startLoc=tokStartLoc;t.endLoc=tokEndLoc;t.type=tokType;t.value=tokVal;return t}getToken.jumpTo=function(pos,reAllowed){tokPos=pos;if(options.locations){tokCurLine=1;tokLineStart=lineBreak.lastIndex=0;var match;while((match=lineBreak.exec(input))&&match.index<pos){++tokCurLine;tokLineStart=match.index+match[0].length}}tokRegexpAllowed=reAllowed;skipSpace()};return getToken};var tokPos;var tokStart,tokEnd;var tokStartLoc,tokEndLoc;var tokType,tokVal;var tokRegexpAllowed;var tokCurLine,tokLineStart;var lastStart,lastEnd,lastEndLoc;var inFunction,labels,strict;function raise(pos,message){var loc=getLineInfo(input,pos);message+=" ("+loc.line+":"+loc.column+")";var err=new SyntaxError(message);err.pos=pos;err.loc=loc;err.raisedAt=tokPos;throw err}var empty=[];var _num={type:"num"},_regexp={type:"regexp"},_string={type:"string"};var _name={type:"name"},_eof={type:"eof"};var _break={keyword:"breakRay"},_case={keyword:"caseRay",beforeExpr:true},_catch={keyword:"catchRay"};var _continue={keyword:"continueRay"},_debugger={keyword:"debuggerRay"},_default={keyword:"defaultRay"};var _do={keyword:"doRay",isLoop:true},_else={keyword:"elseRay",beforeExpr:true};var _finally={keyword:"finallyRay"},_for={keyword:"forRay",isLoop:true},_function={keyword:"raySays"};var _if={keyword:"ifRay"},_return={keyword:"returnRay",beforeExpr:true},_switch={keyword:"switchRay"};var _throw={keyword:"throwRay",beforeExpr:true},_try={keyword:"tryRay"},_var={keyword:"ray"};var _while={keyword:"whileRay",isLoop:true},_with={keyword:"withRay"},_new={keyword:"newRay",beforeExpr:true};var _this={keyword:"him"};var _null={keyword:"null",atomValue:null},_true={keyword:"Ray",atomValue:true};var _false={keyword:"notRay",atomValue:false};var _in={keyword:"in",binop:7,beforeExpr:true};var keywordTypes={breakRay:_break,caseRay:_case,catchRay:_catch,continueRay:_continue,debuggerRay:_debugger,defaultRay:_default,doRay:_do,elseRay:_else,finallyRay:_finally,forRay:_for,raySays:_function,ifRay:_if,returnRay:_return,switchRay:_switch,throwRay:_throw,tryRay:_try,ray:_var,whileRay:_while,withRay:_with,nullRay:_null,Ray:_true,notRay:_false,newRay:_new,inRay:_in,instanceofRay:{keyword:"instanceofRay",binop:7,beforeExpr:true},him:_this,typeofRay:{keyword:"typeofRay",prefix:true,beforeExpr:true},voidRay:{keyword:"voidRay",prefix:true,beforeExpr:true},deleteRay:{keyword:"deleteRay",prefix:true,beforeExpr:true}};var _bracketL={type:"[",beforeExpr:true},_bracketR={type:"]"},_braceL={type:"{",beforeExpr:true};var _braceR={type:"}"},_parenL={type:"(",beforeExpr:true},_parenR={type:")"};var _comma={type:",",beforeExpr:true},_semi={type:";",beforeExpr:true};var _colon={type:":",beforeExpr:true},_dot={type:"."},_question={type:"?",beforeExpr:true};var _slash={binop:10,beforeExpr:true},_eq={isAssign:true,beforeExpr:true};var _assign={isAssign:true,beforeExpr:true};var _incDec={postfix:true,prefix:true,isUpdate:true},_prefix={prefix:true,beforeExpr:true};var _logicalOR={binop:1,beforeExpr:true};var _logicalAND={binop:2,beforeExpr:true};var _bitwiseOR={binop:3,beforeExpr:true};var _bitwiseXOR={binop:4,beforeExpr:true};var _bitwiseAND={binop:5,beforeExpr:true};var _equality={binop:6,beforeExpr:true};var _relational={binop:7,beforeExpr:true};var _bitShift={binop:8,beforeExpr:true};var _plusMin={binop:9,prefix:true,beforeExpr:true};var _multiplyModulo={binop:10,beforeExpr:true};exports.tokTypes={bracketL:_bracketL,bracketR:_bracketR,braceL:_braceL,braceR:_braceR,parenL:_parenL,parenR:_parenR,comma:_comma,semi:_semi,colon:_colon,dot:_dot,question:_question,slash:_slash,eq:_eq,name:_name,eof:_eof,num:_num,regexp:_regexp,string:_string};for(var kw in keywordTypes)exports.tokTypes["_"+kw]=keywordTypes[kw];function makePredicate(words){words=words.split(" ");var f="",cats=[];out:for(var i=0;i<words.length;++i){for(var j=0;j<cats.length;++j)if(cats[j][0].length==words[i].length){cats[j].push(words[i]);continue out}cats.push([words[i]])}function compareTo(arr){if(arr.length==1)return f+="return str === "+JSON.stringify(arr[0])+";";f+="switch(str){";for(var i=0;i<arr.length;++i)f+="case "+JSON.stringify(arr[i])+":";f+="return true}return false;"}if(cats.length>3){cats.sort(function(a,b){return b.length-a.length});f+="switch(str.length){";for(var i=0;i<cats.length;++i){var cat=cats[i];f+="case "+cat[0].length+":";compareTo(cat)}f+="}"}else{compareTo(words)}return new Function("str",f)}var isReservedWord3=makePredicate("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile");var isReservedWord5=makePredicate("class enum extends super const export import");var isStrictReservedWord=makePredicate("implements interface let package private protected public static yield");var isStrictBadIdWord=makePredicate("eval arguments");var isKeyword=makePredicate("breakRay caseRay catchRay continueRay debuggerRay defaultRay doRay elseRay finallyRay forRay raySays ifRay returnRay switchRay throwRay tryRay ray whileRay withRay nullRay Ray notRay instanceofRay typeofRay voidRay deleteRay newRay inRay him");var nonASCIIwhitespace=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;var nonASCIIidentifierStartChars="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ";var nonASCIIidentifierChars="̀-ͯ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿";var nonASCIIidentifierStart=new RegExp("["+nonASCIIidentifierStartChars+"]");var nonASCIIidentifier=new RegExp("["+nonASCIIidentifierStartChars+nonASCIIidentifierChars+"]");var newline=/[\n\r\u2028\u2029]/;var lineBreak=/\r\n|[\n\r\u2028\u2029]/g;var isIdentifierStart=exports.isIdentifierStart=function(code){if(code<65)return code===36;if(code<91)return true;if(code<97)return code===95;if(code<123)return true;return code>=170&&nonASCIIidentifierStart.test(String.fromCharCode(code))};var isIdentifierChar=exports.isIdentifierChar=function(code){if(code<48)return code===36;if(code<58)return true;if(code<65)return false;if(code<91)return true;if(code<97)return code===95;if(code<123)return true;return code>=170&&nonASCIIidentifier.test(String.fromCharCode(code))};function line_loc_t(){this.line=tokCurLine;this.column=tokPos-tokLineStart}function initTokenState(){tokCurLine=1;tokPos=tokLineStart=0;tokRegexpAllowed=true;skipSpace()}function finishToken(type,val){tokEnd=tokPos;if(options.locations)tokEndLoc=new line_loc_t;tokType=type;skipSpace();tokVal=val;tokRegexpAllowed=type.beforeExpr}function skipBlockComment(){var startLoc=options.onComment&&options.locations&&new line_loc_t;var start=tokPos,end=input.indexOf("*/",tokPos+=2);if(end===-1)raise(tokPos-2,"Unterminated comment");tokPos=end+2;if(options.locations){lineBreak.lastIndex=start;var match;while((match=lineBreak.exec(input))&&match.index<tokPos){++tokCurLine;tokLineStart=match.index+match[0].length}}if(options.onComment)options.onComment(true,input.slice(start+2,end),start,tokPos,startLoc,options.locations&&new line_loc_t)}function skipLineComment(){var start=tokPos;var startLoc=options.onComment&&options.locations&&new line_loc_t;var ch=input.charCodeAt(tokPos+=2);while(tokPos<inputLen&&ch!==10&&ch!==13&&ch!==8232&&ch!==8233){++tokPos;ch=input.charCodeAt(tokPos)}if(options.onComment)options.onComment(false,input.slice(start+2,tokPos),start,tokPos,startLoc,options.locations&&new line_loc_t)}function skipSpace(){while(tokPos<inputLen){var ch=input.charCodeAt(tokPos);if(ch===32){++tokPos}else if(ch===13){++tokPos;var next=input.charCodeAt(tokPos);if(next===10){++tokPos}if(options.locations){++tokCurLine;tokLineStart=tokPos}}else if(ch===10||ch===8232||ch===8233){++tokPos;if(options.locations){++tokCurLine;tokLineStart=tokPos}}else if(ch>8&&ch<14){++tokPos}else if(ch===47){var next=input.charCodeAt(tokPos+1);if(next===42){skipBlockComment()}else if(next===47){skipLineComment()}else break}else if(ch===160){++tokPos}else if(ch>=5760&&nonASCIIwhitespace.test(String.fromCharCode(ch))){++tokPos}else{break}}}function readToken_dot(){var next=input.charCodeAt(tokPos+1);if(next>=48&&next<=57)return readNumber(true);++tokPos;return finishToken(_dot)}function readToken_slash(){var next=input.charCodeAt(tokPos+1);if(tokRegexpAllowed){++tokPos;return readRegexp()}if(next===61)return finishOp(_assign,2);return finishOp(_slash,1)}function readToken_mult_modulo(){var next=input.charCodeAt(tokPos+1);if(next===61)return finishOp(_assign,2);return finishOp(_multiplyModulo,1)}function readToken_pipe_amp(code){var next=input.charCodeAt(tokPos+1);if(next===code)return finishOp(code===124?_logicalOR:_logicalAND,2);if(next===61)return finishOp(_assign,2);return finishOp(code===124?_bitwiseOR:_bitwiseAND,1)}function readToken_caret(){var next=input.charCodeAt(tokPos+1);if(next===61)return finishOp(_assign,2);return finishOp(_bitwiseXOR,1)}function readToken_plus_min(code){var next=input.charCodeAt(tokPos+1);if(next===code){if(next==45&&input.charCodeAt(tokPos+2)==62&&newline.test(input.slice(lastEnd,tokPos))){tokPos+=3;skipLineComment();skipSpace();return readToken()}return finishOp(_incDec,2)}if(next===61)return finishOp(_assign,2);return finishOp(_plusMin,1)}function readToken_lt_gt(code){var next=input.charCodeAt(tokPos+1);var size=1;if(next===code){size=code===62&&input.charCodeAt(tokPos+2)===62?3:2;if(input.charCodeAt(tokPos+size)===61)return finishOp(_assign,size+1);return finishOp(_bitShift,size)}if(next==33&&code==60&&input.charCodeAt(tokPos+2)==45&&input.charCodeAt(tokPos+3)==45){tokPos+=4;skipLineComment();skipSpace();return readToken()}if(next===61)size=input.charCodeAt(tokPos+2)===61?3:2;return finishOp(_relational,size)}function readToken_eq_excl(code){var next=input.charCodeAt(tokPos+1);if(next===61)return finishOp(_equality,input.charCodeAt(tokPos+2)===61?3:2);return finishOp(code===61?_eq:_prefix,1)}function getTokenFromCode(code){switch(code){case 46:return readToken_dot();case 40:++tokPos;return finishToken(_parenL);case 41:++tokPos;return finishToken(_parenR);case 59:++tokPos;return finishToken(_semi);case 44:++tokPos;return finishToken(_comma);case 91:++tokPos;return finishToken(_bracketL);case 93:++tokPos;return finishToken(_bracketR);case 123:++tokPos;return finishToken(_braceL);case 125:++tokPos;return finishToken(_braceR);case 58:++tokPos;return finishToken(_colon);case 63:++tokPos;return finishToken(_question);case 48:var next=input.charCodeAt(tokPos+1);if(next===120||next===88)return readHexNumber();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return readNumber(false);case 34:case 39:return readString(code);case 47:return readToken_slash(code);case 37:case 42:return readToken_mult_modulo();case 124:case 38:return readToken_pipe_amp(code);case 94:return readToken_caret();case 43:case 45:return readToken_plus_min(code);case 60:case 62:return readToken_lt_gt(code);case 61:case 33:return readToken_eq_excl(code);case 126:return finishOp(_prefix,1)}return false}function readToken(forceRegexp){if(!forceRegexp)tokStart=tokPos;else tokPos=tokStart+1;if(options.locations)tokStartLoc=new line_loc_t;if(forceRegexp)return readRegexp();if(tokPos>=inputLen)return finishToken(_eof);var code=input.charCodeAt(tokPos);if(isIdentifierStart(code)||code===92)return readWord();var tok=getTokenFromCode(code);if(tok===false){var ch=String.fromCharCode(code);if(ch==="\\"||nonASCIIidentifierStart.test(ch))return readWord();raise(tokPos,"Unexpected character '"+ch+"'")}return tok}function finishOp(type,size){var str=input.slice(tokPos,tokPos+size);tokPos+=size;finishToken(type,str)}function readRegexp(){var content="",escaped,inClass,start=tokPos;for(;;){if(tokPos>=inputLen)raise(start,"Unterminated regular expression");var ch=input.charAt(tokPos);if(newline.test(ch))raise(start,"Unterminated regular expression");if(!escaped){if(ch==="[")inClass=true;else if(ch==="]"&&inClass)inClass=false;else if(ch==="/"&&!inClass)break;escaped=ch==="\\"}else escaped=false;++tokPos}var content=input.slice(start,tokPos);++tokPos;var mods=readWord1();if(mods&&!/^[gmsiy]*$/.test(mods))raise(start,"Invalid regexp flag");return finishToken(_regexp,new RegExp(content,mods))}function readInt(radix,len){var start=tokPos,total=0;for(var i=0,e=len==null?Infinity:len;i<e;++i){var code=input.charCodeAt(tokPos),val;if(code>=97)val=code-97+10;else if(code>=65)val=code-65+10;else if(code>=48&&code<=57)val=code-48;else val=Infinity;if(val>=radix)break;++tokPos;total=total*radix+val}if(tokPos===start||len!=null&&tokPos-start!==len)return null;return total}function readHexNumber(){tokPos+=2;var val=readInt(16);if(val==null)raise(tokStart+2,"Expected hexadecimal number");if(isIdentifierStart(input.charCodeAt(tokPos)))raise(tokPos,"Identifier directly after number");return finishToken(_num,val)}function readNumber(startsWithDot){var start=tokPos,isFloat=false,octal=input.charCodeAt(tokPos)===48;if(!startsWithDot&&readInt(10)===null)raise(start,"Invalid number");if(input.charCodeAt(tokPos)===46){++tokPos;readInt(10);isFloat=true}var next=input.charCodeAt(tokPos);if(next===69||next===101){next=input.charCodeAt(++tokPos);if(next===43||next===45)++tokPos;if(readInt(10)===null)raise(start,"Invalid number");isFloat=true}if(isIdentifierStart(input.charCodeAt(tokPos)))raise(tokPos,"Identifier directly after number");var str=input.slice(start,tokPos),val;if(isFloat)val=parseFloat(str);else if(!octal||str.length===1)val=parseInt(str,10);else if(/[89]/.test(str)||strict)raise(start,"Invalid number");else val=parseInt(str,8);return finishToken(_num,val)}function readString(quote){tokPos++;var out="";for(;;){if(tokPos>=inputLen)raise(tokStart,"Unterminated string constant");var ch=input.charCodeAt(tokPos);if(ch===quote){++tokPos;return finishToken(_string,out)}if(ch===92){ch=input.charCodeAt(++tokPos);var octal=/^[0-7]+/.exec(input.slice(tokPos,tokPos+3));if(octal)octal=octal[0];while(octal&&parseInt(octal,8)>255)octal=octal.slice(0,-1);if(octal==="0")octal=null;++tokPos;if(octal){if(strict)raise(tokPos-2,"Octal literal in strict mode");out+=String.fromCharCode(parseInt(octal,8));tokPos+=octal.length-1}else{switch(ch){case 110:out+="\n";break;case 114:out+="\r";break;case 120:out+=String.fromCharCode(readHexChar(2));break;case 117:out+=String.fromCharCode(readHexChar(4));break;case 85:out+=String.fromCharCode(readHexChar(8));break;case 116:out+="	";break;case 98:out+="\b";break;case 118:out+="";break;case 102:out+="\f";break;case 48:out+="\x00";break;case 13:if(input.charCodeAt(tokPos)===10)++tokPos;case 10:if(options.locations){tokLineStart=tokPos;++tokCurLine}break;default:out+=String.fromCharCode(ch);break}}}else{if(ch===13||ch===10||ch===8232||ch===8233)raise(tokStart,"Unterminated string constant");out+=String.fromCharCode(ch);++tokPos}}}function readHexChar(len){var n=readInt(16,len);if(n===null)raise(tokStart,"Bad character escape sequence");return n}var containsEsc;function readWord1(){containsEsc=false;var word,first=true,start=tokPos;for(;;){var ch=input.charCodeAt(tokPos);if(isIdentifierChar(ch)){if(containsEsc)word+=input.charAt(tokPos);++tokPos}else if(ch===92){if(!containsEsc)word=input.slice(start,tokPos);containsEsc=true;if(input.charCodeAt(++tokPos)!=117)raise(tokPos,"Expecting Unicode escape sequence \\uXXXX");++tokPos;var esc=readHexChar(4);var escStr=String.fromCharCode(esc);if(!escStr)raise(tokPos-1,"Invalid Unicode escape");if(!(first?isIdentifierStart(esc):isIdentifierChar(esc)))raise(tokPos-4,"Invalid Unicode escape");word+=escStr}else{break}first=false}return containsEsc?word:input.slice(start,tokPos)}function readWord(){var word=readWord1();var type=_name;if(!containsEsc){if(isKeyword(word))type=keywordTypes[word];else if(options.forbidReserved&&(options.ecmaVersion===3?isReservedWord3:isReservedWord5)(word)||strict&&isStrictReservedWord(word))raise(tokStart,"The keyword '"+word+"' is reserved")}return finishToken(type,word)}function next(){lastStart=tokStart;lastEnd=tokEnd;lastEndLoc=tokEndLoc;readToken()}function setStrict(strct){strict=strct;tokPos=lastEnd;if(options.locations){while(tokPos<tokLineStart){tokLineStart=input.lastIndexOf("\n",tokLineStart-2)+1;--tokCurLine}}skipSpace();readToken()}function node_t(){this.type=null;this.start=tokStart;this.end=null}function node_loc_t(){this.start=tokStartLoc;this.end=null;if(sourceFile!==null)this.source=sourceFile}function startNode(){var node=new node_t;if(options.locations)node.loc=new node_loc_t;if(options.directSourceFile)node.sourceFile=options.directSourceFile;if(options.ranges)node.range=[tokStart,0];return node}function startNodeFrom(other){var node=new node_t;node.start=other.start;if(options.locations){node.loc=new node_loc_t;node.loc.start=other.loc.start}if(options.ranges)node.range=[other.range[0],0];return node}function finishNode(node,type){node.type=type;node.end=lastEnd;if(options.locations)node.loc.end=lastEndLoc;if(options.ranges)node.range[1]=lastEnd;return node}function isUseStrict(stmt){return options.ecmaVersion>=5&&stmt.type==="ExpressionStatement"&&stmt.expression.type==="Literal"&&stmt.expression.value==="use strict"}function eat(type){if(tokType===type){next();return true}}function canInsertSemicolon(){return!options.strictSemicolons&&(tokType===_eof||tokType===_braceR||newline.test(input.slice(lastEnd,tokStart)))}function semicolon(){if(!eat(_semi)&&!canInsertSemicolon())unexpected()}function expect(type){if(tokType===type)next();else unexpected()}function unexpected(){raise(tokStart,"Unexpected token")}function checkLVal(expr){if(expr.type!=="Identifier"&&expr.type!=="MemberExpression")raise(expr.start,"Assigning to rvalue");if(strict&&expr.type==="Identifier"&&isStrictBadIdWord(expr.name))raise(expr.start,"Assigning to "+expr.name+" in strict mode")}function parseTopLevel(program){lastStart=lastEnd=tokPos;if(options.locations)lastEndLoc=new line_loc_t;inFunction=strict=null;labels=[];readToken();var node=program||startNode(),first=true;if(!program)node.body=[];while(tokType!==_eof){var stmt=parseStatement();node.body.push(stmt);if(first&&isUseStrict(stmt))setStrict(true);first=false}return finishNode(node,"Program")}var loopLabel={kind:"loop"},switchLabel={kind:"switch"};function parseStatement(){if(tokType===_slash||tokType===_assign&&tokVal=="/=")readToken(true);var starttype=tokType,node=startNode();switch(starttype){case _break:case _continue:next();var isBreak=starttype===_break;if(eat(_semi)||canInsertSemicolon())node.label=null;else if(tokType!==_name)unexpected();else{node.label=parseIdent();semicolon()}for(var i=0;i<labels.length;++i){var lab=labels[i];if(node.label==null||lab.name===node.label.name){if(lab.kind!=null&&(isBreak||lab.kind==="loop"))break;if(node.label&&isBreak)break}}if(i===labels.length)raise(node.start,"Unsyntactic "+starttype.keyword);return finishNode(node,isBreak?"BreakStatement":"ContinueStatement");case _debugger:next();semicolon();return finishNode(node,"DebuggerStatement");case _do:next();labels.push(loopLabel);node.body=parseStatement();labels.pop();expect(_while);node.test=parseParenExpression();semicolon();return finishNode(node,"DoWhileStatement");case _for:next();labels.push(loopLabel);expect(_parenL);if(tokType===_semi)return parseFor(node,null);if(tokType===_var){var init=startNode();next();parseVar(init,true);finishNode(init,"VariableDeclaration");if(init.declarations.length===1&&eat(_in))return parseForIn(node,init);return parseFor(node,init)}var init=parseExpression(false,true);if(eat(_in)){checkLVal(init);return parseForIn(node,init)}return parseFor(node,init);case _function:next();return parseFunction(node,true);case _if:next();node.test=parseParenExpression();node.consequent=parseStatement();node.alternate=eat(_else)?parseStatement():null;return finishNode(node,"IfStatement");case _return:if(!inFunction)raise(tokStart,"'return' outside of function");next();if(eat(_semi)||canInsertSemicolon())node.argument=null;else{node.argument=parseExpression();semicolon()}return finishNode(node,"ReturnStatement");case _switch:next();node.discriminant=parseParenExpression();node.cases=[];expect(_braceL);labels.push(switchLabel);for(var cur,sawDefault;tokType!=_braceR;){if(tokType===_case||tokType===_default){var isCase=tokType===_case;if(cur)finishNode(cur,"SwitchCase");node.cases.push(cur=startNode());cur.consequent=[];next();if(isCase)cur.test=parseExpression();else{if(sawDefault)raise(lastStart,"Multiple default clauses");sawDefault=true;cur.test=null}expect(_colon)}else{if(!cur)unexpected();cur.consequent.push(parseStatement())}}if(cur)finishNode(cur,"SwitchCase");next();labels.pop();return finishNode(node,"SwitchStatement");case _throw:next();if(newline.test(input.slice(lastEnd,tokStart)))raise(lastEnd,"Illegal newline after throw");node.argument=parseExpression();semicolon();return finishNode(node,"ThrowStatement");case _try:next();node.block=parseBlock();node.handler=null;if(tokType===_catch){var clause=startNode();next();expect(_parenL);clause.param=parseIdent();if(strict&&isStrictBadIdWord(clause.param.name))raise(clause.param.start,"Binding "+clause.param.name+" in strict mode");expect(_parenR);clause.guard=null;clause.body=parseBlock();node.handler=finishNode(clause,"CatchClause")}node.guardedHandlers=empty;node.finalizer=eat(_finally)?parseBlock():null;if(!node.handler&&!node.finalizer)raise(node.start,"Missing catch or finally clause");return finishNode(node,"TryStatement");case _var:next();parseVar(node);semicolon();return finishNode(node,"VariableDeclaration");case _while:next();node.test=parseParenExpression();labels.push(loopLabel);node.body=parseStatement();labels.pop();return finishNode(node,"WhileStatement");case _with:if(strict)raise(tokStart,"'with' in strict mode");next();node.object=parseParenExpression();node.body=parseStatement();return finishNode(node,"WithStatement");case _braceL:return parseBlock();case _semi:next();return finishNode(node,"EmptyStatement");default:var maybeName=tokVal,expr=parseExpression();if(starttype===_name&&expr.type==="Identifier"&&eat(_colon)){for(var i=0;i<labels.length;++i)if(labels[i].name===maybeName)raise(expr.start,"Label '"+maybeName+"' is already declared");var kind=tokType.isLoop?"loop":tokType===_switch?"switch":null;labels.push({name:maybeName,kind:kind});node.body=parseStatement();labels.pop();node.label=expr;return finishNode(node,"LabeledStatement")}else{node.expression=expr;semicolon();return finishNode(node,"ExpressionStatement")}}}function parseParenExpression(){expect(_parenL);var val=parseExpression();expect(_parenR);return val}function parseBlock(allowStrict){var node=startNode(),first=true,strict=false,oldStrict;node.body=[];expect(_braceL);while(!eat(_braceR)){var stmt=parseStatement();node.body.push(stmt);if(first&&allowStrict&&isUseStrict(stmt)){oldStrict=strict;setStrict(strict=true)}first=false}if(strict&&!oldStrict)setStrict(false);return finishNode(node,"BlockStatement")}function parseFor(node,init){node.init=init;expect(_semi);node.test=tokType===_semi?null:parseExpression();expect(_semi);node.update=tokType===_parenR?null:parseExpression();expect(_parenR);node.body=parseStatement();labels.pop();return finishNode(node,"ForStatement")}function parseForIn(node,init){node.left=init;node.right=parseExpression();expect(_parenR);node.body=parseStatement();labels.pop();return finishNode(node,"ForInStatement")}function parseVar(node,noIn){node.declarations=[];node.kind="var";for(;;){var decl=startNode();decl.id=parseIdent();if(strict&&isStrictBadIdWord(decl.id.name))raise(decl.id.start,"Binding "+decl.id.name+" in strict mode");decl.init=eat(_eq)?parseExpression(true,noIn):null;node.declarations.push(finishNode(decl,"VariableDeclarator"));if(!eat(_comma))break}return node}function parseExpression(noComma,noIn){var expr=parseMaybeAssign(noIn);if(!noComma&&tokType===_comma){var node=startNodeFrom(expr);node.expressions=[expr];while(eat(_comma))node.expressions.push(parseMaybeAssign(noIn));return finishNode(node,"SequenceExpression")}return expr}function parseMaybeAssign(noIn){var left=parseMaybeConditional(noIn);if(tokType.isAssign){var node=startNodeFrom(left);node.operator=tokVal;node.left=left;next();node.right=parseMaybeAssign(noIn);checkLVal(left);return finishNode(node,"AssignmentExpression")}return left}function parseMaybeConditional(noIn){var expr=parseExprOps(noIn);if(eat(_question)){var node=startNodeFrom(expr);node.test=expr;node.consequent=parseExpression(true);expect(_colon);node.alternate=parseExpression(true,noIn);return finishNode(node,"ConditionalExpression")}return expr}function parseExprOps(noIn){return parseExprOp(parseMaybeUnary(),-1,noIn)}function parseExprOp(left,minPrec,noIn){var prec=tokType.binop;if(prec!=null&&(!noIn||tokType!==_in)){if(prec>minPrec){var node=startNodeFrom(left);node.left=left;node.operator=tokVal;var op=tokType;next();node.right=parseExprOp(parseMaybeUnary(),prec,noIn);var exprNode=finishNode(node,op===_logicalOR||op===_logicalAND?"LogicalExpression":"BinaryExpression");return parseExprOp(exprNode,minPrec,noIn)}}return left}function parseMaybeUnary(){if(tokType.prefix){var node=startNode(),update=tokType.isUpdate;node.operator=tokVal;node.prefix=true;tokRegexpAllowed=true;next();node.argument=parseMaybeUnary();if(update)checkLVal(node.argument);else if(strict&&node.operator==="delete"&&node.argument.type==="Identifier")raise(node.start,"Deleting local variable in strict mode");return finishNode(node,update?"UpdateExpression":"UnaryExpression")}var expr=parseExprSubscripts();while(tokType.postfix&&!canInsertSemicolon()){var node=startNodeFrom(expr);node.operator=tokVal;node.prefix=false;node.argument=expr;checkLVal(expr);next();expr=finishNode(node,"UpdateExpression")}return expr}function parseExprSubscripts(){return parseSubscripts(parseExprAtom())}function parseSubscripts(base,noCalls){if(eat(_dot)){var node=startNodeFrom(base);node.object=base;node.property=parseIdent(true);node.computed=false;return parseSubscripts(finishNode(node,"MemberExpression"),noCalls)}else if(eat(_bracketL)){var node=startNodeFrom(base);node.object=base;node.property=parseExpression();node.computed=true;expect(_bracketR);return parseSubscripts(finishNode(node,"MemberExpression"),noCalls)}else if(!noCalls&&eat(_parenL)){var node=startNodeFrom(base);node.callee=base;node.arguments=parseExprList(_parenR,false);return parseSubscripts(finishNode(node,"CallExpression"),noCalls)}else return base}function parseExprAtom(){switch(tokType){case _this:var node=startNode();next();return finishNode(node,"ThisExpression");case _name:return parseIdent();case _num:case _string:case _regexp:var node=startNode();node.value=tokVal;node.raw=input.slice(tokStart,tokEnd);next();return finishNode(node,"Literal");case _null:case _true:case _false:var node=startNode();node.value=tokType.atomValue;node.raw=tokType.keyword;next();return finishNode(node,"Literal");case _parenL:var tokStartLoc1=tokStartLoc,tokStart1=tokStart;next();var val=parseExpression();val.start=tokStart1;val.end=tokEnd;if(options.locations){val.loc.start=tokStartLoc1;val.loc.end=tokEndLoc}if(options.ranges)val.range=[tokStart1,tokEnd];expect(_parenR);return val;case _bracketL:var node=startNode();next();node.elements=parseExprList(_bracketR,true,true);return finishNode(node,"ArrayExpression");case _braceL:return parseObj();case _function:var node=startNode();next();return parseFunction(node,false);case _new:return parseNew();default:unexpected()}}function parseNew(){var node=startNode();next();node.callee=parseSubscripts(parseExprAtom(),true);if(eat(_parenL))node.arguments=parseExprList(_parenR,false);else node.arguments=empty;return finishNode(node,"NewExpression")}function parseObj(){var node=startNode(),first=true,sawGetSet=false;node.properties=[];next();while(!eat(_braceR)){if(!first){expect(_comma);if(options.allowTrailingCommas&&eat(_braceR))break}else first=false;var prop={key:parsePropertyName()},isGetSet=false,kind;if(eat(_colon)){prop.value=parseExpression(true);kind=prop.kind="init"}else if(options.ecmaVersion>=5&&prop.key.type==="Identifier"&&(prop.key.name==="get"||prop.key.name==="set")){isGetSet=sawGetSet=true;kind=prop.kind=prop.key.name;prop.key=parsePropertyName();if(tokType!==_parenL)unexpected();prop.value=parseFunction(startNode(),false)}else unexpected();if(prop.key.type==="Identifier"&&(strict||sawGetSet)){for(var i=0;i<node.properties.length;++i){var other=node.properties[i];if(other.key.name===prop.key.name){var conflict=kind==other.kind||isGetSet&&other.kind==="init"||kind==="init"&&(other.kind==="get"||other.kind==="set");if(conflict&&!strict&&kind==="init"&&other.kind==="init")conflict=false;if(conflict)raise(prop.key.start,"Redefinition of property")}}}node.properties.push(prop)}return finishNode(node,"ObjectExpression")}function parsePropertyName(){if(tokType===_num||tokType===_string)return parseExprAtom();return parseIdent(true)}function parseFunction(node,isStatement){if(tokType===_name)node.id=parseIdent();else if(isStatement)unexpected();else node.id=null;node.params=[];var first=true;expect(_parenL);while(!eat(_parenR)){if(!first)expect(_comma);else first=false;node.params.push(parseIdent())}var oldInFunc=inFunction,oldLabels=labels;inFunction=true;labels=[];node.body=parseBlock(true);inFunction=oldInFunc;labels=oldLabels;if(strict||node.body.body.length&&isUseStrict(node.body.body[0])){for(var i=node.id?-1:0;i<node.params.length;++i){var id=i<0?node.id:node.params[i];if(isStrictReservedWord(id.name)||isStrictBadIdWord(id.name))raise(id.start,"Defining '"+id.name+"' in strict mode");
if(i>=0)for(var j=0;j<i;++j)if(id.name===node.params[j].name)raise(id.start,"Argument name clash in strict mode")}}return finishNode(node,isStatement?"FunctionDeclaration":"FunctionExpression")}function parseExprList(close,allowTrailingComma,allowEmpty){var elts=[],first=true;while(!eat(close)){if(!first){expect(_comma);if(allowTrailingComma&&options.allowTrailingCommas&&eat(close))break}else first=false;if(allowEmpty&&tokType===_comma)elts.push(null);else elts.push(parseExpression(true))}return elts}function parseIdent(liberal){var node=startNode();node.name=tokType===_name?tokVal:liberal&&!options.forbidReserved&&tokType.keyword||unexpected();tokRegexpAllowed=false;next();return finishNode(node,"Identifier")}});"use strict";var Interpreter=function(code,opt_initFunc){this.initFunc_=opt_initFunc;this.UNDEFINED=this.createPrimitive(undefined);this.ast=acorn.parse(code);var scope=this.createScope(this.ast,null);this.stateStack=[{node:this.ast,scope:scope,thisExpression:scope}]};Interpreter.prototype.step=function(){if(this.stateStack.length==0){return false}var state=this.stateStack[0];this["step"+state.node.type]();return true};Interpreter.prototype.run=function(){while(this.step()){}};Interpreter.prototype.initGlobalScope=function(scope){this.setProperty(scope,"Infinity",this.createPrimitive(Infinity),true);this.setProperty(scope,"NaN",this.createPrimitive(NaN),true);this.setProperty(scope,"undefined",this.UNDEFINED,true);this.setProperty(scope,"window",scope,true);this.setProperty(scope,"self",scope,false);this.initFunction(scope);this.initObject(scope);scope.parent=this.OBJECT;this.initArray(scope);this.initNumber(scope);this.initString(scope);this.initBoolean(scope);this.initDate(scope);this.initMath(scope);var thisInterpreter=this;var wrapper;wrapper=function(num){num=num||thisInterpreter.UNDEFINED;return thisInterpreter.createPrimitive(isNaN(num.toNumber()))};this.setProperty(scope,"isNaN",this.createNativeFunction(wrapper));wrapper=function(num){num=num||thisInterpreter.UNDEFINED;return thisInterpreter.createPrimitive(isFinite(num.toNumber()))};this.setProperty(scope,"isFinite",this.createNativeFunction(wrapper));wrapper=function(str){str=str||thisInterpreter.UNDEFINED;return thisInterpreter.createPrimitive(parseFloat(str.toNumber()))};this.setProperty(scope,"parseFloat",this.createNativeFunction(wrapper));wrapper=function(str,radix){str=str||thisInterpreter.UNDEFINED;radix=radix||thisInterpreter.UNDEFINED;return thisInterpreter.createPrimitive(parseInt(str.toString(),radix.toNumber()))};this.setProperty(scope,"parseInt",this.createNativeFunction(wrapper));var func=this.createObject(this.FUNCTION);func.eval=true;this.setProperty(func,"length",this.createPrimitive(1),true);this.setProperty(scope,"eval",func);var strFunctions=["escape","unescape","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent"];for(var i=0;i<strFunctions.length;i++){wrapper=function(nativeFunc){return function(str){str=str||thisInterpreter.UNDEFINED;return thisInterpreter.createPrimitive(nativeFunc(str.toString()))}}(window[strFunctions[i]]);this.setProperty(scope,strFunctions[i],this.createNativeFunction(wrapper))}if(this.initFunc_){this.initFunc_(this,scope)}};Interpreter.prototype.initFunction=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(var_args){if(this.parent==thisInterpreter.FUNCTION){var newFunc=this}else{var newFunc=thisInterpreter.createObject(thisInterpreter.FUNCTION)}if(arguments.length){var code=arguments[arguments.length-1].toString()}else{var code=""}var args=[];for(var i=0;i<arguments.length-1;i++){args.push(arguments[i].toString())}args=args.join(", ");if(args.indexOf(")")!=-1){throw new SyntaxError("Function arg string contains parenthesis")}newFunc.parentScope=thisInterpreter.stateStack[thisInterpreter.stateStack.length-1].scope;var ast=acorn.parse("$ = function("+args+") {"+code+"};");newFunc.node=ast.body[0].expression.right;thisInterpreter.setProperty(newFunc,"length",thisInterpreter.createPrimitive(newFunc.node.length),true);return newFunc};this.FUNCTION=this.createObject(null);this.setProperty(scope,"Function",this.FUNCTION);this.FUNCTION.type="function";this.setProperty(this.FUNCTION,"prototype",this.createObject(null));this.FUNCTION.nativeFunc=wrapper;var node={type:"FunctionApply_",params:[],id:null,body:null,start:0,end:0};this.setProperty(this.FUNCTION.properties.prototype,"apply",this.createFunction(node,{}),false,true);var node={type:"FunctionCall_",params:[],id:null,body:null,start:0,end:0};this.setProperty(this.FUNCTION.properties.prototype,"call",this.createFunction(node,{}),false,true);wrapper=function(){return thisInterpreter.createPrimitive(this.toString())};this.setProperty(this.FUNCTION.properties.prototype,"toString",this.createNativeFunction(wrapper),false,true);this.setProperty(this.FUNCTION,"toString",this.createNativeFunction(wrapper),false,true);wrapper=function(){return thisInterpreter.createPrimitive(this.valueOf())};this.setProperty(this.FUNCTION.properties.prototype,"valueOf",this.createNativeFunction(wrapper),false,true);this.setProperty(this.FUNCTION,"valueOf",this.createNativeFunction(wrapper),false,true)};Interpreter.prototype.initObject=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(var_args){if(this.parent==thisInterpreter.OBJECT){var newObj=this}else{var newObj=thisInterpreter.createObject(thisInterpreter.OBJECT)}return newObj};this.OBJECT=this.createNativeFunction(wrapper);this.setProperty(scope,"Object",this.OBJECT);wrapper=function(){return thisInterpreter.createPrimitive(this.toString())};this.setProperty(this.OBJECT.properties.prototype,"toString",this.createNativeFunction(wrapper),false,true);wrapper=function(){return thisInterpreter.createPrimitive(this.valueOf())};this.setProperty(this.OBJECT.properties.prototype,"valueOf",this.createNativeFunction(wrapper),false,true)};Interpreter.prototype.initArray=function(scope){var thisInterpreter=this;var getInt=function(obj,def){var n=obj?Math.floor(obj.toNumber()):def;if(isNaN(n)){n=def}return n};var wrapper;wrapper=function(var_args){if(this.parent==thisInterpreter.ARRAY){var newArray=this}else{var newArray=thisInterpreter.createObject(thisInterpreter.ARRAY)}var first=arguments[0];if(first&&first.type=="number"){if(isNaN(thisInterpreter.arrayIndex(first))){throw new RangeError("Invalid array length")}newArray.length=first.data}else{for(var i=0;i<arguments.length;i++){newArray.properties[i]=arguments[i]}newArray.length=i}return newArray};this.ARRAY=this.createNativeFunction(wrapper);this.setProperty(scope,"Array",this.ARRAY);wrapper=function(){if(this.length){var value=this.properties[this.length-1];delete this.properties[this.length-1];this.length--}else{var value=thisInterpreter.UNDEFINED}return value};this.setProperty(this.ARRAY.properties.prototype,"pop",this.createNativeFunction(wrapper),false,true);wrapper=function(var_args){for(var i=0;i<arguments.length;i++){this.properties[this.length]=arguments[i];this.length++}return thisInterpreter.createPrimitive(this.length)};this.setProperty(this.ARRAY.properties.prototype,"push",this.createNativeFunction(wrapper),false,true);wrapper=function(){if(this.length){var value=this.properties[0];for(var i=1;i<this.length;i++){this.properties[i-1]=this.properties[i]}this.length--;delete this.properties[this.length]}else{var value=thisInterpreter.UNDEFINED}return value};this.setProperty(this.ARRAY.properties.prototype,"shift",this.createNativeFunction(wrapper),false,true);wrapper=function(var_args){for(var i=this.length-1;i>=0;i--){this.properties[i+arguments.length]=this.properties[i]}this.length+=arguments.length;for(var i=0;i<arguments.length;i++){this.properties[i]=arguments[i]}return thisInterpreter.createPrimitive(this.length)};this.setProperty(this.ARRAY.properties.prototype,"unshift",this.createNativeFunction(wrapper),false,true);wrapper=function(){for(var i=0;i<this.length/2;i++){var tmp=this.properties[this.length-i-1];this.properties[this.length-i-1]=this.properties[i];this.properties[i]=tmp}return thisInterpreter.UNDEFINED};this.setProperty(this.ARRAY.properties.prototype,"reverse",this.createNativeFunction(wrapper),false,true);wrapper=function(index,howmany,var_args){index=getInt(index,0);if(index<0){index=Math.max(this.length+index,0)}else{index=Math.min(index,this.length)}howmany=getInt(howmany,Infinity);howmany=Math.min(howmany,this.length-index);var removed=thisInterpreter.createObject(thisInterpreter.ARRAY);for(var i=index;i<index+howmany;i++){removed.properties[removed.length++]=this.properties[i];this.properties[i]=this.properties[i+howmany]}for(var i=index+howmany;i<this.length;i++){delete this.properties[i]}this.length-=howmany;for(var i=this.length-1;i>=index;i--){this.properties[i+arguments.length-2]=this.properties[i]}this.length+=arguments.length-2;for(var i=2;i<arguments.length;i++){this.properties[index+i-2]=arguments[i]}return removed};this.setProperty(this.ARRAY.properties.prototype,"splice",this.createNativeFunction(wrapper),false,true);wrapper=function(opt_begin,opt_end){var list=thisInterpreter.createObject(thisInterpreter.ARRAY);var begin=getInt(opt_begin,0);if(begin<0){begin=this.length+begin}begin=Math.max(0,Math.min(begin,this.length));var end=getInt(opt_end,this.length);if(end<0){end=this.length+end}end=Math.max(0,Math.min(end,this.length));var length=0;for(var i=begin;i<end;i++){var element=thisInterpreter.getProperty(this,i);thisInterpreter.setProperty(list,length++,element)}return list};this.setProperty(this.ARRAY.properties.prototype,"slice",this.createNativeFunction(wrapper),false,true);wrapper=function(opt_separator){if(!opt_separator||opt_separator.data===undefined){var sep=undefined}else{var sep=opt_separator.toString()}var text=[];for(var i=0;i<this.length;i++){text[i]=this.properties[i]}return thisInterpreter.createPrimitive(text.join(sep))};this.setProperty(this.ARRAY.properties.prototype,"join",this.createNativeFunction(wrapper),false,true);wrapper=function(var_args){var list=thisInterpreter.createObject(thisInterpreter.ARRAY);var length=0;for(var i=0;i<this.length;i++){var element=thisInterpreter.getProperty(this,i);thisInterpreter.setProperty(list,length++,element)}for(var i=0;i<arguments.length;i++){var value=arguments[i];if(thisInterpreter.isa(value,thisInterpreter.ARRAY)){for(var j=0;j<value.length;j++){var element=thisInterpreter.getProperty(value,j);thisInterpreter.setProperty(list,length++,element)}}else{thisInterpreter.setProperty(list,length++,value)}}return list};this.setProperty(this.ARRAY.properties.prototype,"concat",this.createNativeFunction(wrapper),false,true);wrapper=function(searchElement,opt_fromIndex){searchElement=searchElement||thisInterpreter.UNDEFINED;var fromIndex=getInt(opt_fromIndex,0);if(fromIndex<0){fromIndex=this.length+fromIndex}fromIndex=Math.max(0,Math.min(fromIndex,this.length));for(var i=fromIndex;i<this.length;i++){var element=thisInterpreter.getProperty(this,i);if(thisInterpreter.comp(element,searchElement)==0){return thisInterpreter.createPrimitive(i)}}return thisInterpreter.createPrimitive(-1)};this.setProperty(this.ARRAY.properties.prototype,"indexOf",this.createNativeFunction(wrapper),false,true);wrapper=function(searchElement,opt_fromIndex){searchElement=searchElement||thisInterpreter.UNDEFINED;var fromIndex=getInt(opt_fromIndex,this.length);if(fromIndex<0){fromIndex=this.length+fromIndex}fromIndex=Math.max(0,Math.min(fromIndex,this.length));for(var i=fromIndex;i>=0;i--){var element=thisInterpreter.getProperty(this,i);if(thisInterpreter.comp(element,searchElement)==0){return thisInterpreter.createPrimitive(i)}}return thisInterpreter.createPrimitive(-1)};this.setProperty(this.ARRAY.properties.prototype,"lastIndexOf",this.createNativeFunction(wrapper),false,true)};Interpreter.prototype.initNumber=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(value){value=value?value.toNumber():0;if(this.parent==thisInterpreter.NUMBER){this.toBoolean=function(){return!!value};this.toNumber=function(){return value};this.toString=function(){return String(value)};return undefined}else{return thisInterpreter.createPrimitive(value)}};this.NUMBER=this.createNativeFunction(wrapper);this.setProperty(scope,"Number",this.NUMBER);var numConsts=["MAX_VALUE","MIN_VALUE","NaN","NEGATIVE_INFINITY","POSITIVE_INFINITY"];for(var i=0;i<numConsts.length;i++){this.setProperty(this.NUMBER,numConsts[i],this.createPrimitive(Number[numConsts[i]]))}wrapper=function(fractionDigits){fractionDigits=fractionDigits?fractionDigits.toNumber():undefined;var n=this.toNumber();return thisInterpreter.createPrimitive(n.toExponential(fractionDigits))};this.setProperty(this.NUMBER.properties.prototype,"toExponential",this.createNativeFunction(wrapper),false,true);wrapper=function(digits){digits=digits?digits.toNumber():undefined;var n=this.toNumber();return thisInterpreter.createPrimitive(n.toFixed(digits))};this.setProperty(this.NUMBER.properties.prototype,"toFixed",this.createNativeFunction(wrapper),false,true);wrapper=function(precision){precision=precision?precision.toNumber():undefined;var n=this.toNumber();return thisInterpreter.createPrimitive(n.toPrecision(precision))};this.setProperty(this.NUMBER.properties.prototype,"toPrecision",this.createNativeFunction(wrapper),false,true)};Interpreter.prototype.initString=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(value){value=(value||thisInterpreter.UNDEFINED).toString();if(this.parent==thisInterpreter.STRING){this.toBoolean=function(){return!!value};this.toNumber=function(){return Number(value)};this.toString=function(){return value};this.valueOf=function(){return value};this.data=value;return undefined}else{return thisInterpreter.createPrimitive(value)}};this.STRING=this.createNativeFunction(wrapper);this.setProperty(scope,"String",this.STRING);var functions=["toLowerCase","toUpperCase","toLocaleLowerCase","toLocaleUpperCase"];for(var i=0;i<functions.length;i++){var wrapper=function(nativeFunc){return function(){return thisInterpreter.createPrimitive(nativeFunc.apply(this))}}(String.prototype[functions[i]]);this.setProperty(this.STRING.properties.prototype,functions[i],this.createNativeFunction(wrapper),false,true)}wrapper=function(){var str=this.toString();return thisInterpreter.createPrimitive(str.replace(/^\s+|\s+$/g,""))};this.setProperty(this.STRING.properties.prototype,"trim",this.createNativeFunction(wrapper),false,true);wrapper=function(){var str=this.toString();return thisInterpreter.createPrimitive(str.replace(/^\s+/g,""))};this.setProperty(this.STRING.properties.prototype,"trimLeft",this.createNativeFunction(wrapper),false,true);wrapper=function(){var str=this.toString();return thisInterpreter.createPrimitive(str.replace(/\s+$/g,""))};this.setProperty(this.STRING.properties.prototype,"trimRight",this.createNativeFunction(wrapper),false,true);wrapper=function(num){var str=this.toString();num=(num||thisInterpreter.UNDEFINED).toNumber();return thisInterpreter.createPrimitive(str.charAt(num))};this.setProperty(this.STRING.properties.prototype,"charAt",this.createNativeFunction(wrapper),false,true);wrapper=function(num){var str=this.toString();num=(num||thisInterpreter.UNDEFINED).toNumber();return thisInterpreter.createPrimitive(str.charCodeAt(num))};this.setProperty(this.STRING.properties.prototype,"charCodeAt",this.createNativeFunction(wrapper),false,true);wrapper=function(searchValue,fromIndex){var str=this.toString();searchValue=(searchValue||thisInterpreter.UNDEFINED).toString();fromIndex=fromIndex?fromIndex.toNumber():undefined;return thisInterpreter.createPrimitive(str.indexOf(searchValue,fromIndex))};this.setProperty(this.STRING.properties.prototype,"indexOf",this.createNativeFunction(wrapper),false,true);wrapper=function(searchValue,fromIndex){var str=this.toString();searchValue=(searchValue||thisInterpreter.UNDEFINED).toString();fromIndex=fromIndex?fromIndex.toNumber():undefined;return thisInterpreter.createPrimitive(str.lastIndexOf(searchValue,fromIndex))};this.setProperty(this.STRING.properties.prototype,"lastIndexOf",this.createNativeFunction(wrapper),false,true);wrapper=function(separator,limit){var str=this.toString();separator=separator?separator.toString():undefined;limit=limit?limit.toNumber():undefined;var jsList=str.split(separator,limit);var pseudoList=thisInterpreter.createObject(thisInterpreter.ARRAY);for(var i=0;i<jsList.length;i++){thisInterpreter.setProperty(pseudoList,i,thisInterpreter.createPrimitive(jsList[i]))}return pseudoList};this.setProperty(this.STRING.properties.prototype,"split",this.createNativeFunction(wrapper),false,true);wrapper=function(indexA,indexB){var str=this.toString();indexA=indexA?indexA.toNumber():undefined;indexB=indexB?indexB.toNumber():undefined;return thisInterpreter.createPrimitive(str.substring(indexA,indexB))};this.setProperty(this.STRING.properties.prototype,"substring",this.createNativeFunction(wrapper),false,true);wrapper=function(start,length){var str=this.toString();start=start?start.toNumber():undefined;length=length?length.toNumber():undefined;return thisInterpreter.createPrimitive(str.substr(start,length))};this.setProperty(this.STRING.properties.prototype,"substr",this.createNativeFunction(wrapper),false,true);wrapper=function(var_args){var str=this.toString();for(var i=0;i<arguments.length;i++){str+=arguments[i].toString()}return thisInterpreter.createPrimitive(str)};this.setProperty(this.STRING.properties.prototype,"concat",this.createNativeFunction(wrapper),false,true)};Interpreter.prototype.initBoolean=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(value){value=value?value.toBoolean():false;if(this.parent==thisInterpreter.STRING){this.toBoolean=function(){return value};this.toNumber=function(){return Number(value)};this.toString=function(){return String(value)};this.valueOf=function(){return value};return undefined}else{return thisInterpreter.createPrimitive(value)}};this.BOOLEAN=this.createNativeFunction(wrapper);this.setProperty(scope,"Boolean",this.BOOLEAN)};Interpreter.prototype.initDate=function(scope){var thisInterpreter=this;var wrapper;wrapper=function(a,b,c,d,e,f,h){if(this.parent==thisInterpreter.DATE){var newDate=this}else{var newDate=thisInterpreter.createObject(thisInterpreter.DATE)}var dateString=a;if(!arguments.length){newDate.date=new Date}else if(arguments.length==1&&(dateString.type=="string"||thisInterpreter.isa(dateString,thisInterpreter.STRING))){newDate.date=new Date(dateString.toString())}else{var args=[];for(var i=0;i<arguments.length;i++){args[i]=arguments[i]?arguments[i].toNumber():undefined}if(args.length==1){newDate.date=new Date(args[0])}else if(args.length==2){newDate.date=new Date(args[0],args[1])}else if(args.length==3){newDate.date=new Date(args[0],args[1],args[2])}else if(args.length==4){newDate.date=new Date(args[0],args[1],args[2],args[3])}else if(args.length==5){newDate.date=new Date(args[0],args[1],args[2],args[3],args[4])}else if(args.length==7){newDate.date=new Date(args[0],args[1],args[2],args[3],args[4],args[5])}else{newDate.date=new Date(args[0],args[1],args[2],args[3],args[4],args[5],args[6])}}newDate.toString=function(){return String(this.date)};newDate.toNumber=function(){return Number(this.date)};newDate.valueOf=function(){return this.date.valueOf()};return newDate};this.DATE=this.createNativeFunction(wrapper);this.setProperty(scope,"Date",this.DATE);wrapper=function(){return thisInterpreter.createPrimitive((new Date).getTime())};this.setProperty(this.DATE,"now",this.createNativeFunction(wrapper),false,true);wrapper=function(dateString){dateString=dateString?dateString.toString():undefined;return thisInterpreter.createPrimitive(Date.parse(dateString))};this.setProperty(this.DATE,"parse",this.createNativeFunction(wrapper),false,true);wrapper=function(a,b,c,d,e,f,h){var args=[];for(var i=0;i<arguments.length;i++){args[i]=arguments[i]?arguments[i].toNumber():undefined}return thisInterpreter.createPrimitive(Date.UTC.apply(Date,args))};this.setProperty(this.DATE,"UTC",this.createNativeFunction(wrapper),false,true);var getFunctions=["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear"];for(var i=0;i<getFunctions.length;i++){wrapper=function(nativeFunc){return function(){return thisInterpreter.createPrimitive(this.date[nativeFunc]())}}(getFunctions[i]);this.setProperty(this.DATE.properties.prototype,getFunctions[i],this.createNativeFunction(wrapper),false,true)}var setFunctions=["setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear"];for(var i=0;i<setFunctions.length;i++){wrapper=function(nativeFunc){return function(var_args){var args=[];for(var i=0;i<arguments.length;i++){args[i]=arguments[i]?arguments[i].toNumber():undefined}return thisInterpreter.createPrimitive(this.date[nativeFunc].apply(this.date,args))}}(setFunctions[i]);this.setProperty(this.DATE.properties.prototype,setFunctions[i],this.createNativeFunction(wrapper),false,true)}var getFunctions=["toDateString","toISOString","toGMTString","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString"];for(var i=0;i<getFunctions.length;i++){wrapper=function(nativeFunc){return function(){return thisInterpreter.createPrimitive(this.date[nativeFunc]())}}(getFunctions[i]);this.setProperty(this.DATE.properties.prototype,getFunctions[i],this.createNativeFunction(wrapper),false,true)}};Interpreter.prototype.initMath=function(scope){var thisInterpreter=this;var myMath=this.createObject(this.OBJECT);this.setProperty(scope,"Math",myMath);var mathConsts=["E","LN2","LN10","LOG2E","LOG10E","PI","SQRT1_2","SQRT2"];for(var i=0;i<mathConsts.length;i++){this.setProperty(myMath,mathConsts[i],this.createPrimitive(Math[mathConsts[i]]))}var numFunctions=["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","random","round","sin","sqrt","tan"];for(var i=0;i<numFunctions.length;i++){var wrapper=function(nativeFunc){return function(){for(var j=0;j<arguments.length;j++){arguments[j]=arguments[j].toNumber()}return thisInterpreter.createPrimitive(nativeFunc.apply(Math,arguments))}}(Math[numFunctions[i]]);this.setProperty(myMath,numFunctions[i],this.createNativeFunction(wrapper))}};Interpreter.prototype.isa=function(child,parent){if(!child||!parent){return false}else if(child.parent==parent){return true}else if(!child.parent||!child.parent.prototype){return false}return this.isa(child.parent.prototype,parent)};Interpreter.prototype.comp=function(a,b){if(a.isPrimitive&&typeof a=="number"&&isNaN(a.data)||b.isPrimitive&&typeof b=="number"&&isNaN(b.data)){return NaN}if(a.isPrimitive&&b.isPrimitive){a=a.data;b=b.data}else{return NaN}if(a<b){return-1}else if(a>b){return 1}return 0};Interpreter.prototype.arrayIndex=function(n){n=Number(n);if(!isFinite(n)||n!=Math.floor(n)||n<0){return NaN}return n};Interpreter.prototype.createPrimitive=function(data){var type=typeof data;var obj={data:data,isPrimitive:true,type:type,toBoolean:function(){return Boolean(this.data)},toNumber:function(){return Number(this.data)},toString:function(){return String(this.data)},valueOf:function(){return this.data}};if(type=="number"){obj.parent=this.NUMBER}else if(type=="string"){obj.parent=this.STRING}else if(type=="boolean"){obj.parent=this.BOOLEAN}return obj};Interpreter.prototype.createObject=function(parent){var obj={isPrimitive:false,type:"object",parent:parent,fixed:Object.create(null),nonenumerable:Object.create(null),properties:Object.create(null),toBoolean:function(){return true},toNumber:function(){return 0},toString:function(){return"["+this.type+"]"},valueOf:function(){return this}};if(this.isa(obj,this.FUNCTION)){obj.type="function";this.setProperty(obj,"prototype",this.createObject(this.OBJECT||null))}if(this.isa(obj,this.ARRAY)){obj.length=0;obj.toString=function(){var strs=[];for(var i=0;i<this.length;i++){strs[i]=this.properties[i].toString()}return strs.join(",")}}return obj};Interpreter.prototype.createFunction=function(node,opt_scope){var func=this.createObject(this.FUNCTION);func.parentScope=opt_scope||this.getScope();func.node=node;this.setProperty(func,"length",this.createPrimitive(func.node.params.length),true);return func};Interpreter.prototype.createNativeFunction=function(nativeFunc){var func=this.createObject(this.FUNCTION);func.nativeFunc=nativeFunc;this.setProperty(func,"length",this.createPrimitive(nativeFunc.length),true);return func};Interpreter.prototype.getProperty=function(obj,name){name=name.toString();if(this.isa(obj,this.STRING)){if(name=="length"){return this.createPrimitive(obj.data.length)}var n=this.arrayIndex(name);if(!isNaN(n)&&n<obj.data.length){return this.createPrimitive(obj.data[n])}}else if(this.isa(obj,this.ARRAY)&&name=="length"){return this.createPrimitive(obj.length)}while(true){if(obj.properties&&name in obj.properties){return obj.properties[name]}if(obj.parent&&obj.parent.properties&&obj.parent.properties.prototype){obj=obj.parent.properties.prototype}else{break}}return this.UNDEFINED};Interpreter.prototype.hasProperty=function(obj,name){name=name.toString();if(obj.isPrimitive){throw new TypeError("Primitive data type has no properties")}if(name=="length"&&(this.isa(obj,this.STRING)||this.isa(obj,this.ARRAY))){return true}if(this.isa(obj,this.STRING)){var n=this.arrayIndex(name);if(!isNaN(n)&&n<obj.data.length){return true}}while(true){if(obj.properties&&name in obj.properties){return true}if(obj.parent&&obj.parent.properties&&obj.parent.properties.prototype){obj=obj.parent.properties.prototype}else{break}}return false};Interpreter.prototype.setProperty=function(obj,name,value,opt_fixed,opt_nonenum){name=name.toString();if(obj.isPrimitive||obj.fixed[name]){return}if(this.isa(obj,this.STRING)){var n=this.arrayIndex(name);if(name=="length"||!isNaN(n)&&n<obj.data.length){return}}if(this.isa(obj,this.ARRAY)){var i;if(name=="length"){var newLength=this.arrayIndex(value.toNumber());if(isNaN(newLength)){throw new RangeError("Invalid array length")}if(newLength<obj.length){for(i in obj.properties){i=this.arrayIndex(i);if(!isNaN(i)&&newLength<=i){delete obj.properties[i]}}}obj.length=newLength;return}else if(!isNaN(i=this.arrayIndex(name))){obj.length=Math.max(obj.length,i+1)}}obj.properties[name]=value;if(opt_fixed){obj.fixed[name]=true}if(opt_nonenum){obj.nonenumerable[name]=true}};Interpreter.prototype.deleteProperty=function(obj,name){name=name.toString();if(obj.isPrimitive||obj.fixed[name]){return false}if(name=="length"&&this.isa(obj,this.ARRAY)){return false}return delete obj.properties[name]};Interpreter.prototype.getScope=function(){for(var i=0;i<this.stateStack.length;i++){if(this.stateStack[i].scope){return this.stateStack[i].scope}}throw"No scope found."};Interpreter.prototype.createScope=function(node,parentScope){var scope=this.createObject(null);scope.parentScope=parentScope;if(!parentScope){this.initGlobalScope(scope)}this.populateScope_(node,scope);return scope};Interpreter.prototype.getValueFromScope=function(name){var scope=this.getScope();var nameStr=name.toString();while(scope){if(this.hasProperty(scope,nameStr)){return this.getProperty(scope,nameStr)}scope=scope.parentScope}throw"Unknown identifier: "+nameStr};Interpreter.prototype.setValueToScope=function(name,value){var scope=this.getScope();var nameStr=name.toString();while(scope){if(this.hasProperty(scope,nameStr)){return this.setProperty(scope,nameStr,value)}scope=scope.parentScope}throw"Unknown identifier: "+nameStr};Interpreter.prototype.populateScope_=function(node,scope){if(node.type=="VariableDeclaration"){for(var i=0;i<node.declarations.length;i++){this.setProperty(scope,node.declarations[i].id.name,undefined)}}else if(node.type=="FunctionDeclaration"){this.setProperty(scope,node.id.name,this.createFunction(node,scope));return}else if(node.type=="FunctionExpression"){return}var thisIterpreter=this;function recurse(child){if(child.constructor==thisIterpreter.ast.constructor){thisIterpreter.populateScope_(child,scope)}}for(var name in node){var prop=node[name];if(prop&&typeof prop=="object"){if(typeof prop.length=="number"&&prop.splice){for(var i=0;i<prop.length;i++){recurse(prop[i])}}else{recurse(prop)}}}};Interpreter.prototype.getValue=function(left){if(left.length){var obj=left[0];var prop=left[1];return this.getProperty(obj,prop)}else{return this.getValueFromScope(left)}};Interpreter.prototype.setValue=function(left,value){if(left.length){var obj=left[0];var prop=left[1];this.setProperty(obj,prop,value)}else{this.setValueToScope(left,value)}};Interpreter.prototype["stepArrayExpression"]=function(){var state=this.stateStack[0];var node=state.node;var n=state.n||0;if(!state.array){state.array=this.createObject(this.ARRAY)}else{this.setProperty(state.array,n-1,state.value)}if(node.elements[n]){state.n=n+1;this.stateStack.unshift({node:node.elements[n]})}else{state.array.length=state.n||0;this.stateStack.shift();this.stateStack[0].value=state.array}};Interpreter.prototype["stepAssignmentExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.doneLeft){state.doneLeft=true;this.stateStack.unshift({node:node.left,components:true})}else if(!state.doneRight){state.doneRight=true;state.leftSide=state.value;this.stateStack.unshift({node:node.right})}else{this.stateStack.shift();var leftSide=state.leftSide;var rightSide=state.value;var value;if(node.operator=="="){value=rightSide}else{var leftValue=this.getValue(leftSide);var rightValue=rightSide;var leftNumber=leftValue.toNumber();var rightNumber=rightValue.toNumber();if(node.operator=="+="){var left,right;if(leftValue.type=="string"||rightValue.type=="string"){left=leftValue.toString();right=rightValue.toString()}else{left=leftNumber;right=rightNumber}value=left+right}else if(node.operator=="-="){value=leftNumber-rightNumber}else if(node.operator=="*="){value=leftNumber*rightNumber}else if(node.operator=="/="){value=leftNumber/rightNumber}else if(node.operator=="%="){value=leftNumber%rightNumber}else if(node.operator=="<<="){value=leftNumber<<rightNumber}else if(node.operator==">>="){value=leftNumber>>rightNumber}else if(node.operator==">>>="){value=leftNumber>>>rightNumber}else if(node.operator=="&="){value=leftNumber&rightNumber}else if(node.operator=="^="){value=leftNumber^rightNumber}else if(node.operator=="|="){value=leftNumber|rightNumber}else{throw"Unknown assignment expression: "+node.operator}value=this.createPrimitive(value)}this.setValue(leftSide,value);this.stateStack[0].value=value}};Interpreter.prototype["stepBinaryExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.doneLeft){state.doneLeft=true;this.stateStack.unshift({node:node.left})}else if(!state.doneRight){state.doneRight=true;state.leftValue=state.value;this.stateStack.unshift({node:node.right})}else{this.stateStack.shift();var leftSide=state.leftValue;var rightSide=state.value;var value;var comp=this.comp(leftSide,rightSide);if(node.operator=="=="||node.operator=="!="){value=comp===0;if(node.operator=="!="){value=!value}}else if(node.operator=="==="||node.operator=="!=="){if(leftSide.isPrimitive&&rightSide.isPrimitive){value=leftSide.data===rightSide.data}else{value=leftSide===rightSide}if(node.operator=="!=="){value=!value}}else if(node.operator==">"){value=comp==1}else if(node.operator==">="){value=comp==1||comp===0}else if(node.operator=="<"){value=comp==-1}else if(node.operator=="<="){value=comp==-1||comp===0}else if(node.operator=="+"){if(leftSide.type=="string"||rightSide.type=="string"){var leftValue=leftSide.toString();var rightValue=rightSide.toString()}else{var leftValue=leftSide.toNumber();var rightValue=rightSide.toNumber()}value=leftValue+rightValue}else if(node.operator=="in"){value=this.hasProperty(rightSide,leftSide)
}else{var leftValue=leftSide.toNumber();var rightValue=rightSide.toNumber();if(node.operator=="-"){value=leftValue-rightValue}else if(node.operator=="*"){value=leftValue*rightValue}else if(node.operator=="/"){value=leftValue/rightValue}else if(node.operator=="%"){value=leftValue%rightValue}else if(node.operator=="&"){value=leftValue&rightValue}else if(node.operator=="|"){value=leftValue|rightValue}else if(node.operator=="^"){value=leftValue^rightValue}else if(node.operator=="<<"){value=leftValue<<rightValue}else if(node.operator==">>"){value=leftValue>>rightValue}else if(node.operator==">>>"){value=leftValue>>>rightValue}else{throw"Unknown binary operator: "+node.operator}}this.stateStack[0].value=this.createPrimitive(value)}};Interpreter.prototype["stepBreakStatement"]=function(){var state=this.stateStack.shift();var node=state.node;var label=null;if(node.label){label=node.label.name}state=this.stateStack.shift();while(state&&state.node.type!="callExpression"){if(label?label==state.label:state.isLoop){return}state=this.stateStack.shift()}throw new SyntaxError("Illegal break statement")};Interpreter.prototype["stepBlockStatement"]=function(){var state=this.stateStack[0];var node=state.node;var n=state.n_||0;if(node.body[n]){state.n_=n+1;this.stateStack.unshift({node:node.body[n]})}else{this.stateStack.shift()}};Interpreter.prototype["stepCallExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.doneCallee_){state.doneCallee_=true;this.stateStack.unshift({node:node.callee,components:true})}else{if(!state.func_){if(state.value.type=="function"){state.func_=state.value}else{state.member_=state.value[0];state.func_=this.getValue(state.value);if(!state.func_||state.func_.type!="function"){throw new TypeError((state.func_&&state.func_.type)+" is not a function")}}if(state.node.type=="NewExpression"){state.funcThis_=this.createObject(state.func_);state.isConstructor_=true}else if(state.value.length){state.funcThis_=state.value[0]}else{state.funcThis_=this.stateStack[this.stateStack.length-1].thisExpression}state.arguments=[];var n=0}else{var n=state.n_;if(state.arguments.length!=node.arguments.length){state.arguments[n-1]=state.value}}if(node.arguments[n]){state.n_=n+1;this.stateStack.unshift({node:node.arguments[n]})}else if(!state.doneExec){state.doneExec=true;if(state.func_.node&&(state.func_.node.type=="FunctionApply_"||state.func_.node.type=="FunctionCall_")){state.funcThis_=state.arguments.shift();if(state.func_.node.type=="FunctionApply_"){var argsList=state.arguments.shift();if(argsList&&this.isa(argsList,this.ARRAY)){state.arguments=[];for(var i=0;i<argsList.length;i++){state.arguments[i]=this.getProperty(argsList,i)}}else{state.arguments=[]}}state.func_=state.member_}if(state.func_.node){var scope=this.createScope(state.func_.node.body,state.func_.parentScope);for(var i=0;i<state.func_.node.params.length;i++){var paramName=this.createPrimitive(state.func_.node.params[i].name);var paramValue=state.arguments.length>i?state.arguments[i]:this.UNDEFINED;this.setProperty(scope,paramName,paramValue)}var argsList=this.createObject(this.ARRAY);for(var i=0;i<state.arguments.length;i++){this.setProperty(argsList,this.createPrimitive(i),state.arguments[i])}this.setProperty(scope,"arguments",argsList);var funcState={node:state.func_.node.body,scope:scope,thisExpression:state.funcThis_};this.stateStack.unshift(funcState)}else if(state.func_.nativeFunc){state.value=state.func_.nativeFunc.apply(state.funcThis_,state.arguments)}else if(state.func_.eval){var code=state.arguments[0];if(!code){state.value=this.UNDEFINED}else if(!code.isPrimitive){state.value=code}else{var evalInterpreter=new Interpreter(code.toString());evalInterpreter.stateStack[0].scope.parentScope=this.getScope();var state={node:{type:"Eval_"},interpreter:evalInterpreter};this.stateStack.unshift(state)}}else{throw new TypeError("function not a function (huh?)")}}else{this.stateStack.shift();this.stateStack[0].value=state.isConstructor_?state.funcThis_:state.value}}};Interpreter.prototype["stepConditionalExpression"]=function(){var state=this.stateStack[0];if(!state.done){if(!state.test){state.test=true;this.stateStack.unshift({node:state.node.test})}else{state.done=true;if(state.value.toBoolean()&&state.node.consequent){this.stateStack.unshift({node:state.node.consequent})}else if(!state.value.toBoolean()&&state.node.alternate){this.stateStack.unshift({node:state.node.alternate})}}}else{this.stateStack.shift();if(state.node.type=="ConditionalExpression"){this.stateStack[0].value=state.value}}};Interpreter.prototype["stepContinueStatement"]=function(){var node=this.stateStack[0].node;var label=null;if(node.label){label=node.label.name}var state=this.stateStack[0];while(state&&state.node.type!="callExpression"){if(state.isLoop){if(!label||label==state.label){return}}this.stateStack.shift();state=this.stateStack[0]}throw new SyntaxError("Illegal continue statement")};Interpreter.prototype["stepDoWhileStatement"]=function(){var state=this.stateStack[0];state.isLoop=true;if(state.node.type=="DoWhileStatement"&&state.test===undefined){state.value=this.createPrimitive(true);state.test=true}if(!state.test){state.test=true;this.stateStack.unshift({node:state.node.test})}else{state.test=false;if(!state.value.toBoolean()){this.stateStack.shift()}else if(state.node.body){this.stateStack.unshift({node:state.node.body})}}};Interpreter.prototype["stepEmptyStatement"]=function(){this.stateStack.shift()};Interpreter.prototype["stepEval_"]=function(){var state=this.stateStack[0];if(!state.interpreter.step()){this.stateStack.shift();this.stateStack[0].value=state.interpreter.value||this.UNDEFINED}};Interpreter.prototype["stepExpressionStatement"]=function(){var state=this.stateStack[0];if(!state.done){state.done=true;this.stateStack.unshift({node:state.node.expression})}else{this.stateStack.shift();this.value=state.value}};Interpreter.prototype["stepForInStatement"]=function(){var state=this.stateStack[0];state.isLoop=true;var node=state.node;if(!state.doneVariable_){state.doneVariable_=true;var left=node.left;if(left.type=="VariableDeclaration"){left=left.declarations[0].id}this.stateStack.unshift({node:left,components:true})}else if(!state.doneObject_){state.doneObject_=true;state.variable=state.value;this.stateStack.unshift({node:node.right})}else{if(typeof state.iterator=="undefined"){state.object=state.value;state.iterator=0}var name=null;done:do{var i=state.iterator;for(var prop in state.object.properties){if(prop in state.object.nonenumerable){continue}if(i==0){name=prop;break done}i--}state.object=state.object.parent&&state.object.parent.properties.prototype;state.iterator=0}while(state.object);state.iterator++;if(name===null){this.stateStack.shift()}else{this.setValueToScope(state.variable,this.createPrimitive(name));if(node.body){this.stateStack.unshift({node:node.body})}}}};Interpreter.prototype["stepForStatement"]=function(){var state=this.stateStack[0];state.isLoop=true;var node=state.node;var mode=state.mode||0;if(mode==0){state.mode=1;if(node.init){this.stateStack.unshift({node:node.init})}}else if(mode==1){state.mode=2;if(node.test){this.stateStack.unshift({node:node.test})}}else if(mode==2){state.mode=3;if(state.value&&!state.value.toBoolean()){this.stateStack.shift()}else if(node.body){this.stateStack.unshift({node:node.body})}}else if(mode==3){state.mode=1;if(node.update){this.stateStack.unshift({node:node.update})}}};Interpreter.prototype["stepFunctionDeclaration"]=function(){this.stateStack.shift()};Interpreter.prototype["stepFunctionExpression"]=function(){var state=this.stateStack[0];this.stateStack.shift();this.stateStack[0].value=this.createFunction(state.node)};Interpreter.prototype["stepIdentifier"]=function(){var state=this.stateStack[0];this.stateStack.shift();var name=this.createPrimitive(state.node.name);this.stateStack[0].value=state.components?name:this.getValueFromScope(name)};Interpreter.prototype["stepIfStatement"]=Interpreter.prototype["stepConditionalExpression"];Interpreter.prototype["stepLabeledStatement"]=function(){var state=this.stateStack.shift();this.stateStack.unshift({node:state.node.body,label:state.node.label.name})};Interpreter.prototype["stepLiteral"]=function(){var state=this.stateStack[0];this.stateStack.shift();this.stateStack[0].value=this.createPrimitive(state.node.value)};Interpreter.prototype["stepLogicalExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(node.operator!="&&"&&node.operator!="||"){throw"Unknown logical operator: "+node.operator}if(!state.doneLeft_){state.doneLeft_=true;this.stateStack.unshift({node:node.left})}else if(!state.doneRight_){if(node.operator=="&&"&&!state.value.toBoolean()||node.operator=="||"&&state.value.toBoolean()){this.stateStack.shift();this.stateStack[0].value=state.value}else{state.doneRight_=true;this.stateStack.unshift({node:node.right})}}else{this.stateStack.shift();this.stateStack[0].value=state.value}};Interpreter.prototype["stepMemberExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.doneObject_){state.doneObject_=true;this.stateStack.unshift({node:node.object})}else if(!state.doneProperty_){state.doneProperty_=true;state.object=state.value;this.stateStack.unshift({node:node.property,components:!node.computed})}else{this.stateStack.shift();if(state.components){this.stateStack[0].value=[state.object,state.value]}else{this.stateStack[0].value=this.getProperty(state.object,state.value)}}};Interpreter.prototype["stepNewExpression"]=Interpreter.prototype["stepCallExpression"];Interpreter.prototype["stepObjectExpression"]=function(){var state=this.stateStack[0];var node=state.node;var valueToggle=state.valueToggle;var n=state.n||0;if(!state.object){state.object=this.createObject(this.OBJECT)}else{if(valueToggle){state.key=state.value}else{this.setProperty(state.object,state.key,state.value)}}if(node.properties[n]){if(valueToggle){state.n=n+1;this.stateStack.unshift({node:node.properties[n].value})}else{this.stateStack.unshift({node:node.properties[n].key,components:true})}state.valueToggle=!valueToggle}else{this.stateStack.shift();this.stateStack[0].value=state.object}};Interpreter.prototype["stepProgram"]=Interpreter.prototype["stepBlockStatement"];Interpreter.prototype["stepReturnStatement"]=function(){var state=this.stateStack[0];var node=state.node;if(node.argument&&!state.done){state.done=true;this.stateStack.unshift({node:node.argument})}else{var value=state.value;do{this.stateStack.shift();if(this.stateStack.length==0){throw new SyntaxError("Illegal return statement")}state=this.stateStack[0]}while(state.node.type!="CallExpression");state.value=value}};Interpreter.prototype["stepSequenceExpression"]=function(){var state=this.stateStack[0];var node=state.node;var n=state.n||0;if(node.expressions[n]){state.n=n+1;this.stateStack.unshift({node:node.expressions[n]})}else{this.stateStack.shift();this.stateStack[0].value=state.value}};Interpreter.prototype["stepThisExpression"]=function(){this.stateStack.shift();for(var i=0;i<this.stateStack.length;i++){if(this.stateStack[i].thisExpression){this.stateStack[0].value=this.stateStack[i].thisExpression;return}}throw"No this expression found."};Interpreter.prototype["stepThrowStatement"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.argument){state.argument=true;this.stateStack.unshift({node:node.argument})}else{throw state.value.toString()}};Interpreter.prototype["stepUnaryExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.done){state.done=true;var nextState={node:node.argument};if(node.operator=="delete"){nextState.components=true}this.stateStack.unshift(nextState)}else{this.stateStack.shift();var value;if(node.operator=="-"){value=-state.value.toNumber()}else if(node.operator=="!"){value=!state.value.toNumber()}else if(node.operator=="~"){value=~state.value.toNumber()}else if(node.operator=="typeof"){value=state.value.type}else if(node.operator=="delete"){if(state.value.length){var obj=state.value[0];var name=state.value[1]}else{var obj=this.getScope();var name=state.value}value=this.deleteProperty(obj,name)}else if(node.operator=="void"){value=undefined}else{throw"Unknown unary operator: "+node.operator}this.stateStack[0].value=this.createPrimitive(value)}};Interpreter.prototype["stepUpdateExpression"]=function(){var state=this.stateStack[0];var node=state.node;if(!state.done){state.done=true;this.stateStack.unshift({node:node.argument,components:true})}else{this.stateStack.shift();var leftSide=state.value;var leftValue=this.getValue(leftSide).toNumber();var changeValue;if(node.operator=="++"){changeValue=this.createPrimitive(leftValue+1)}else if(node.operator=="--"){changeValue=this.createPrimitive(leftValue-1)}else{throw"Unknown update expression: "+node.operator}this.setValue(leftSide,changeValue);var returnValue=node.prefix?returnValue:leftValue;this.stateStack[0].value=this.createPrimitive(returnValue)}};Interpreter.prototype["stepVariableDeclaration"]=function(){var state=this.stateStack[0];var node=state.node;var n=state.n||0;if(node.declarations[n]){state.n=n+1;this.stateStack.unshift({node:node.declarations[n]})}else{this.stateStack.shift()}};Interpreter.prototype["stepVariableDeclarator"]=function(){var state=this.stateStack[0];var node=state.node;if(node.init&&!state.done){state.done=true;this.stateStack.unshift({node:node.init})}else{if(!this.hasProperty(this,node.id.name)||node.init){var value=node.init?state.value:this.UNDEFINED;this.setValue(this.createPrimitive(node.id.name),value)}this.stateStack.shift()}};Interpreter.prototype["stepWhileStatement"]=Interpreter.prototype["stepDoWhileStatement"];window["Interpreter"]=Interpreter;Interpreter.prototype["step"]=Interpreter.prototype.step;Interpreter.prototype["run"]=Interpreter.prototype.run;