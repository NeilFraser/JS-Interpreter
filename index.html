<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JS-Interpreter Demo</title>
  <link href="demos/style.css" rel="stylesheet" type="text/css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script>
    // Depending on the URL argument, test the compressed or uncompressed version.
    var compressed = (document.location.search == '?compressed');
    if (compressed) {
      document.write('<scr'+'ipt src="acorn_interpreter.js"></scr'+'ipt>');
    } else {
      document.write('<scr'+'ipt src="acorn.js"></scr'+'ipt>');
      document.write('<scr'+'ipt src="interpreter.js"></scr'+'ipt>');
    }

    var myInterpreter;
    function initAlert(interpreter, globalObject) {
      var wrapper = function alert(text) {
        return window.alert(arguments.length ? text : '');
      };
      interpreter.setProperty(globalObject, 'alert',
          interpreter.createNativeFunction(wrapper));
    }

    function parseButton() {
      var code = document.getElementById('code').value;
      myInterpreter = new Interpreter(code, initAlert);
      disable('');
    }

    function stepButton() {
      var stack = myInterpreter.getStateStack();
      if (stack.length) {
        var node = stack[stack.length - 1].node;
        var start = node.start;
        var end = node.end;
      } else {
        var start = 0;
        var end = 0;
      }
      createSelection(start, end);
      try {
        var ok = myInterpreter.step();
      } finally {
        if (!ok) {
          disable('disabled');
        }
      }
    }

    function runButton() {
      disable('disabled');
      if (myInterpreter.run()) {
        // Async function hit.  There's more code to run.
        setTimeout(runButton, 100);
      }
    }

    function disable(disabled) {
      document.getElementById('stepButton').disabled = disabled;
      document.getElementById('runButton').disabled = disabled;
    }

    function createSelection(start, end) {
      var field = document.getElementById('code');
      if (field.createTextRange) {
        var selRange = field.createTextRange();
        selRange.collapse(true);
        selRange.moveStart('character', start);
        selRange.moveEnd('character', end);
        selRange.select();
      } else if (field.setSelectionRange) {
        field.setSelectionRange(start, end);
      } else if (field.selectionStart) {
        field.selectionStart = start;
        field.selectionEnd = end;
      }
      field.focus();
    }
    
    // Enable dark mode
    darkmode = () =>{
      if(document.body.style.backgroundColor == "white"){
        document.body.style.backgroundColor = " #343434";
        document.body.style.color = "white";
        document.getElementById("code").style.backgroundColor = "black";
        document.getElementById("code").style.color = "white";
      }
      else{
        document.body.style.backgroundColor = "white";
        document.body.style.color = " #343434";
        document.getElementById("code").style.backgroundColor = "white";
        document.getElementById("code").style.color = "black";
      }
    }
  </script>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark my-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">JS-Interpreter Demo</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">

      <div class="form-check form-switch text-light">
        <input onclick="darkmode()"class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Double Click For FirstTime">
        <label class="form-check-label" for="flexSwitchCheckDefault" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Double Click For FirstTime">Click To Switch</label>
      </div>

    </div>
  </div>
   
</nav>


<!-- Alert box for steps -->

<div class="container" >
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong>Enter JavaScript code below, then click </strong> To execute, either
    click <em>Step</em> repeatedly, or click <em>Run</em> once.
    Open your browser's console for errors
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>


  <p><textarea id="code" spellcheck="false" class="mx-5 my-4">
var result = [];
function fibonacci(n, output) {
  var a = 1, b = 1, sum;
  for (var i = 0; i &lt; n; i++) {
    output.push(a);
    sum = a + b;
    a = b;
    b = sum;
  }
}
fibonacci(16, result);
alert(result.join(', '));

</textarea>
<br>

  <button type="button" class="btn btn-outline-primary mx-5" onclick="parseButton()">Parse</button>
  <button onclick="stepButton()" id="stepButton" disabled="disabled" class="mx-1 btn-outline-info">Step</button>
  <button onclick="runButton()" id="runButton" disabled="disabled" class="mx-1 btn-outline-info">Run</button>
  </p>

  <p><small>
  <script>
    if (compressed) {
      document.write('[ Running compressed bundle.  Switch to <A HREF="?uncompressed">raw sources</A>. ]');
    } else {
      document.write('[ Running raw sources.  Switch to <A HREF="?compressed">compressed bundle</A>. ]');
    }
    disable('disabled');
  </script>
  </small></p>

  <p class="footerpara">Read the <a href="docs.html">JS-Interpreter documentation</a>.</p>
  <p class="footerpara">Get the <a href="https://github.com/NeilFraser/JS-Interpreter">source code</a>.</p>

</body>
</html>
